version: '3.7'

secrets:
  SECRET_KEY:
    file: ./docker/secrets/SECRET_KEY
  TYPEORM_USERNAME:
    file: ./docker/secrets/TYPEORM_USERNAME
  TYPEORM_PASSWORD:
    file: ./docker/secrets/TYPEORM_PASSWORD
  TYPEORM_HOST:
    file: ./docker/secrets/TYPEORM_HOST
  TYPEORM_DATABASE:
    file: ./docker/secrets/TYPEORM_DATABASE
  POSTGRES_PASSWORD:
    file: ./docker/secrets/POSTGRES_PASSWORD

networks:
  net:

services:
  api:
    secrets:
      - SECRET_KEY
      - TYPEORM_USERNAME
      - TYPEORM_PASSWORD
      - TYPEORM_HOST
      - TYPEORM_DATABASE

  db:
    image: postgres:10-alpine
    environment:
      - POSTGRES_PASSWORD_FILE=/run/secrets/POSTGRES_PASSWORD
    secrets:
      - POSTGRES_PASSWORD
    networks:
      - net
